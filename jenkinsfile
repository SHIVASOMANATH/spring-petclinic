pipeline {
    agent { label 'JDK-17' }
    options {
        timeout(time: 1, unit: 'HOURS')
    }
    triggers {
        pollSCM('* * * * *')
    }
    tools {
        jdk 'JDK_17'
        maven 'MAVEN_3.9'
    }
    stages {
        stage ('VCS') {
            steps {
                git url: 'https://github.com/SHIVASOMANATH/spring-petclinic.git',
                    branch: 'develop'
            }
        }
        stage('SonarQube analysis') {
            steps{
    // performing sonarqube analysis with "withSonarQubeENV(<Name of Server configured in Jenkins>)"
            withSonarQubeEnv('SONAR_CLOUD_SHIVA') {
      // requires SonarQube Scanner for Maven 3.2+
            sh 'mvn package sonar:sonar \
               -Dsonar.token=7427c1924e2cdc701360b70bfb84463f0cadc92d\
               -Dsonar.host.url=https://sonarcloud.io \
               -Dsonar.organization=springpetclinic-somanath \
               -Dsonar.projectKey=springpetclinic-somanath_somanath'
// 
        // stage ('Jfrog Artifactory Configuration') {
            //  steps {
                // rtMavenDeployer (
                    // id: "SPC_DEPLOYER",
                    // serverId: "JENKINS__JFROG_SHIVA",
                    // releaseRepo: 'somanath_spc-libs-release-local',
                    // snapshotRepo: 'somanath_spc-libs-release-local'
                // )
                // rtMavenRun (
                    // tool: "MAVEN_3.9",
                    // pom: "pom.xml", 
                    // goals: "clean install",
                    // deployerId: "SPC_DEPLOYER"
                    ,
                    buildName: "${JOB_NAME}",
                    buildNumber: "${BUILD_ID}"
                // )
                // rtPublishBuildInfo (
                    // serverId: "JENKINS__JFROG_SHIVA"
                // ) 
            // }
        // }
            }
        }
    }           
        // stage ('Build and Package') {
            // steps {
            //   sh script: 'mvn package'
            // }     
        // }
        // stage ('Reporting') {
            // steps {
            //    archiveArtifacts artifacts: '**/target/spring-petclinic-*.jar'
            //    junit testResults: '**/target/surefire-reports/TEST-*.xml'
        //    }
        // }
        // stage ('Deploy terraform') {
            // steps{
                // sh "cd vmdeploy/"
                // sh "terraform init && terraform fmt && terraform apply -auto-approve"
            // }
        // }
        // stage ('Deploy Ansible'){
            // steps{
                // sh "terraform output -raw spc_url > hosts"
                // sh "export ANSIBLE_HOST_KEY_CHECKING=False"
                // sh "ansible-playbook -i hosts --key-file '/home/dell/somanath1.pem' nop.yaml"
            // }
        // }
    }
} 